; PlatformIO Configuration for EpicWeatherBox Firmware
; Custom firmware for SmallTV-Ultra hardware
; https://docs.platformio.org/page/projectconf.html

[platformio]
default_envs = esp8266

[env:esp8266]
platform = espressif8266
board = esp12e
framework = arduino

; CPU frequency (80 or 160 MHz)
board_build.f_cpu = 160000000L

; Flash configuration (adjust based on your device)
board_build.flash_mode = dio
board_build.f_flash = 40000000L
board_build.ldscript = eagle.flash.4m1m.ld

; Serial monitor
monitor_speed = 115200

; Build flags
build_flags =
    -D ARDUINO_ESP8266_RELEASE="esp8266"
    -D PIO_FRAMEWORK_ARDUINO_LWIP2_LOW_MEMORY
    -D BEARSSL_SSL_BASIC
    ; Optimize for size
    -Os

    ; =========================================
    ; TFT_eSPI Configuration for SmallTV-Ultra
    ; ST7789 240x240 display
    ; =========================================
    -D USER_SETUP_LOADED=1
    -D ST7789_DRIVER=1
    -D TFT_WIDTH=240
    -D TFT_HEIGHT=240
    -D TFT_RGB_ORDER=TFT_RGB

    ; Pin definitions (confirmed from hardware RE)
    -D TFT_CS=4
    -D TFT_DC=0
    -D TFT_RST=2
    -D TFT_MOSI=13
    -D TFT_SCLK=14
    ; Backlight controlled separately via GPIO5

    ; SPI Configuration
    -D SPI_FREQUENCY=40000000
    -D SPI_READ_FREQUENCY=20000000

    ; Fonts (enable what we need, disable rest to save flash)
    -D LOAD_GLCD=1
    -D LOAD_FONT2=1
    -D LOAD_FONT4=1
    -D LOAD_FONT6=1
    -D LOAD_FONT7=1
    -D LOAD_FONT8=1
    -D LOAD_GFXFF=1
    -D SMOOTH_FONT=1

; Library dependencies
lib_deps =
    ; WiFi Manager for easy setup
    tzapu/WiFiManager@^0.16.0
    ; JSON parsing
    bblanchon/ArduinoJson@^7.0.4
    ; Async Web Server
    me-no-dev/ESPAsyncTCP@^1.2.2
    me-no-dev/ESPAsyncWebServer@^1.2.3
    ; TFT Display
    bodmer/TFT_eSPI@^2.5.0
    ; NTP time sync
    arduino-libraries/NTPClient@^3.2.1
    ; Timezone handling
    jchristensen/Timezone@^1.2.4
    ; HTTP client for weather API (built-in to ESP8266)
    ; JSON streaming parser for memory efficiency
    squix78/JsonStreamingParser@^1.0.5

; LittleFS filesystem (SPIFFS is deprecated)
board_build.filesystem = littlefs

; Upload settings (uncomment and adjust for OTA)
; upload_protocol = espota
; upload_port = 192.168.1.xxx
; upload_flags =
;     --port=8266
;     --auth=password

; Partition scheme
; Using 1MB for code, 3MB for SPIFFS (adjust as needed)

[env:esp8266_debug]
extends = env:esp8266
build_type = debug
build_flags =
    ${env:esp8266.build_flags}
    -D DEBUG_ESP_PORT=Serial
    -D DEBUG_ESP_CORE
    -D DEBUG_ESP_WIFI
    -D DEBUG_ESP_HTTP_CLIENT
